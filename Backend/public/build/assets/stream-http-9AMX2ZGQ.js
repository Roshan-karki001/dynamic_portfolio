import{c as d}from"./available-typed-arrays-Bdx1BH74.js";import{B as p,p as T}from"./vite-plugin-node-polyfills-CBtbB8OZ.js";import{i as S}from"./inherits-BlmhoU4v.js";import{r as H}from"./readable-stream-DPzF383x.js";import{i as q}from"./xtend-CeaPpq3n.js";import{b as L}from"./builtin-status-codes-_5kiYP-w.js";import{u as P}from"./url-tX9oqq6S.js";var I={},O={exports:{}},g={};(function(e){e.fetch=t(d.fetch)&&t(d.ReadableStream),e.writableStream=t(d.WritableStream),e.abortController=t(d.AbortController);var r;function s(){if(r!==void 0)return r;if(d.XMLHttpRequest){r=new d.XMLHttpRequest;try{r.open("GET",d.XDomainRequest?"/":"https://example.com")}catch{r=null}}else r=null;return r}function n(l){var i=s();if(!i)return!1;try{return i.responseType=l,i.responseType===l}catch{}return!1}e.arraybuffer=e.fetch||n("arraybuffer"),e.msstream=!e.fetch&&n("ms-stream"),e.mozchunkedarraybuffer=!e.fetch&&n("moz-chunked-arraybuffer"),e.overrideMimeType=e.fetch||(s()?t(s().overrideMimeType):!1);function t(l){return typeof l=="function"}r=null})(g);var y={},R=g,N=S,k=H,v=y.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},C=y.IncomingMessage=function(e,r,s,n){var t=this;if(k.Readable.call(t),t._mode=s,t.headers={},t.rawHeaders=[],t.trailers={},t.rawTrailers=[],t.on("end",function(){T.nextTick(function(){t.emit("close")})}),s==="fetch"){let h=function(){i.read().then(function(a){if(!t._destroyed){if(n(a.done),a.done){t.push(null);return}t.push(p.from(a.value)),h()}}).catch(function(a){n(!0),t._destroyed||t.emit("error",a)})};if(t._fetchResponse=r,t.url=r.url,t.statusCode=r.status,t.statusMessage=r.statusText,r.headers.forEach(function(a,f){t.headers[f.toLowerCase()]=a,t.rawHeaders.push(f,a)}),R.writableStream){var l=new WritableStream({write:function(a){return n(!1),new Promise(function(f,b){t._destroyed?b():t.push(p.from(a))?f():t._resumeFetch=f})},close:function(){n(!0),t._destroyed||t.push(null)},abort:function(a){n(!0),t._destroyed||t.emit("error",a)}});try{r.body.pipeTo(l).catch(function(a){n(!0),t._destroyed||t.emit("error",a)});return}catch{}}var i=r.body.getReader();h()}else{t._xhr=e,t._pos=0,t.url=e.responseURL,t.statusCode=e.status,t.statusMessage=e.statusText;var o=e.getAllResponseHeaders().split(/\r?\n/);if(o.forEach(function(h){var a=h.match(/^([^:]+):\s*(.*)/);if(a){var f=a[1].toLowerCase();f==="set-cookie"?(t.headers[f]===void 0&&(t.headers[f]=[]),t.headers[f].push(a[2])):t.headers[f]!==void 0?t.headers[f]+=", "+a[2]:t.headers[f]=a[2],t.rawHeaders.push(a[1],a[2])}}),t._charset="x-user-defined",!R.overrideMimeType){var u=t.rawHeaders["mime-type"];if(u){var m=u.match(/;\s*charset=([^;])(;|$)/);m&&(t._charset=m[1].toLowerCase())}t._charset||(t._charset="utf-8")}}};N(C,k.Readable);C.prototype._read=function(){var e=this,r=e._resumeFetch;r&&(e._resumeFetch=null,r())};C.prototype._onXHRProgress=function(e){var r=this,s=r._xhr,n=null;switch(r._mode){case"text":if(n=s.responseText,n.length>r._pos){var t=n.substr(r._pos);if(r._charset==="x-user-defined"){for(var l=p.alloc(t.length),i=0;i<t.length;i++)l[i]=t.charCodeAt(i)&255;r.push(l)}else r.push(t,r._charset);r._pos=n.length}break;case"arraybuffer":if(s.readyState!==v.DONE||!s.response)break;n=s.response,r.push(p.from(new Uint8Array(n)));break;case"moz-chunked-arraybuffer":if(n=s.response,s.readyState!==v.LOADING||!n)break;r.push(p.from(new Uint8Array(n)));break;case"ms-stream":if(n=s.response,s.readyState!==v.LOADING)break;var o=new d.MSStreamReader;o.onprogress=function(){o.result.byteLength>r._pos&&(r.push(p.from(new Uint8Array(o.result.slice(r._pos)))),r._pos=o.result.byteLength)},o.onload=function(){e(!0),r.push(null)},o.readAsArrayBuffer(n);break}r._xhr.readyState===v.DONE&&r._mode!=="ms-stream"&&(e(!0),r.push(null))};var _=g,D=S,M=y,E=H,U=M.IncomingMessage,A=M.readyStates;function B(e,r){return _.fetch&&r?"fetch":_.mozchunkedarraybuffer?"moz-chunked-arraybuffer":_.msstream?"ms-stream":_.arraybuffer&&e?"arraybuffer":"text"}var c=O.exports=function(e){var r=this;E.Writable.call(r),r._opts=e,r._body=[],r._headers={},e.auth&&r.setHeader("Authorization","Basic "+p.from(e.auth).toString("base64")),Object.keys(e.headers).forEach(function(t){r.setHeader(t,e.headers[t])});var s,n=!0;if(e.mode==="disable-fetch"||"requestTimeout"in e&&!_.abortController)n=!1,s=!0;else if(e.mode==="prefer-streaming")s=!1;else if(e.mode==="allow-wrong-content-type")s=!_.overrideMimeType;else if(!e.mode||e.mode==="default"||e.mode==="prefer-fast")s=!0;else throw new Error("Invalid value for opts.mode");r._mode=B(s,n),r._fetchTimer=null,r._socketTimeout=null,r._socketTimer=null,r.on("finish",function(){r._onFinish()})};D(c,E.Writable);c.prototype.setHeader=function(e,r){var s=this,n=e.toLowerCase();X.indexOf(n)===-1&&(s._headers[n]={name:e,value:r})};c.prototype.getHeader=function(e){var r=this._headers[e.toLowerCase()];return r?r.value:null};c.prototype.removeHeader=function(e){var r=this;delete r._headers[e.toLowerCase()]};c.prototype._onFinish=function(){var e=this;if(!e._destroyed){var r=e._opts;"timeout"in r&&r.timeout!==0&&e.setTimeout(r.timeout);var s=e._headers,n=null;r.method!=="GET"&&r.method!=="HEAD"&&(n=new Blob(e._body,{type:(s["content-type"]||{}).value||""}));var t=[];if(Object.keys(s).forEach(function(u){var m=s[u].name,h=s[u].value;Array.isArray(h)?h.forEach(function(a){t.push([m,a])}):t.push([m,h])}),e._mode==="fetch"){var l=null;if(_.abortController){var i=new AbortController;l=i.signal,e._fetchAbortController=i,"requestTimeout"in r&&r.requestTimeout!==0&&(e._fetchTimer=d.setTimeout(function(){e.emit("requestTimeout"),e._fetchAbortController&&e._fetchAbortController.abort()},r.requestTimeout))}d.fetch(e._opts.url,{method:e._opts.method,headers:t,body:n||void 0,mode:"cors",credentials:r.withCredentials?"include":"same-origin",signal:l}).then(function(u){e._fetchResponse=u,e._resetTimers(!1),e._connect()},function(u){e._resetTimers(!0),e._destroyed||e.emit("error",u)})}else{var o=e._xhr=new d.XMLHttpRequest;try{o.open(e._opts.method,e._opts.url,!0)}catch(u){T.nextTick(function(){e.emit("error",u)});return}"responseType"in o&&(o.responseType=e._mode),"withCredentials"in o&&(o.withCredentials=!!r.withCredentials),e._mode==="text"&&"overrideMimeType"in o&&o.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in r&&(o.timeout=r.requestTimeout,o.ontimeout=function(){e.emit("requestTimeout")}),t.forEach(function(u){o.setRequestHeader(u[0],u[1])}),e._response=null,o.onreadystatechange=function(){switch(o.readyState){case A.LOADING:case A.DONE:e._onXHRProgress();break}},e._mode==="moz-chunked-arraybuffer"&&(o.onprogress=function(){e._onXHRProgress()}),o.onerror=function(){e._destroyed||(e._resetTimers(!0),e.emit("error",new Error("XHR error")))};try{o.send(n)}catch(u){T.nextTick(function(){e.emit("error",u)});return}}}};function G(e){try{var r=e.status;return r!==null&&r!==0}catch{return!1}}c.prototype._onXHRProgress=function(){var e=this;e._resetTimers(!1),!(!G(e._xhr)||e._destroyed)&&(e._response||e._connect(),e._response._onXHRProgress(e._resetTimers.bind(e)))};c.prototype._connect=function(){var e=this;e._destroyed||(e._response=new U(e._xhr,e._fetchResponse,e._mode,e._resetTimers.bind(e)),e._response.on("error",function(r){e.emit("error",r)}),e.emit("response",e._response))};c.prototype._write=function(e,r,s){var n=this;n._body.push(e),s()};c.prototype._resetTimers=function(e){var r=this;d.clearTimeout(r._socketTimer),r._socketTimer=null,e?(d.clearTimeout(r._fetchTimer),r._fetchTimer=null):r._socketTimeout&&(r._socketTimer=d.setTimeout(function(){r.emit("timeout")},r._socketTimeout))};c.prototype.abort=c.prototype.destroy=function(e){var r=this;r._destroyed=!0,r._resetTimers(!0),r._response&&(r._response._destroyed=!0),r._xhr?r._xhr.abort():r._fetchAbortController&&r._fetchAbortController.abort(),e&&r.emit("error",e)};c.prototype.end=function(e,r,s){var n=this;typeof e=="function"&&(s=e,e=void 0),E.Writable.prototype.end.call(n,e,r,s)};c.prototype.setTimeout=function(e,r){var s=this;r&&s.once("timeout",r),s._socketTimeout=e,s._resetTimers(!1)};c.prototype.flushHeaders=function(){};c.prototype.setNoDelay=function(){};c.prototype.setSocketKeepAlive=function(){};var X=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],$=O.exports;(function(e){var r=$,s=y,n=q,t=L,l=P,i=e;i.request=function(o,u){typeof o=="string"?o=l.parse(o):o=n(o);var m=d.location.protocol.search(/^https?:$/)===-1?"http:":"",h=o.protocol||m,a=o.hostname||o.host,f=o.port,b=o.path||"/";a&&a.indexOf(":")!==-1&&(a="["+a+"]"),o.url=(a?h+"//"+a:"")+(f?":"+f:"")+b,o.method=(o.method||"GET").toUpperCase(),o.headers=o.headers||{};var w=new r(o);return u&&w.on("response",u),w},i.get=function(u,m){var h=i.request(u,m);return h.end(),h},i.ClientRequest=r,i.IncomingMessage=s.IncomingMessage,i.Agent=function(){},i.Agent.defaultMaxSockets=4,i.globalAgent=new i.Agent,i.STATUS_CODES=t,i.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]})(I);export{I as s};
